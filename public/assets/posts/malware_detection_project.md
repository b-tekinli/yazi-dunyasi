Malware Detection Projesi
==============

![](https://cdn-images-1.medium.com/max/800/0*O6bUCDNNv9DNFORK.jpg)

Merhabalar, Shuhari Researchers topluluÄŸunda yeni araÅŸtÄ±rma konularÄ±mÄ±zdan biri olan malware nasÄ±l tespit edilir, hangi araÃ§lar kullanÄ±lÄ±r gibi konu baÅŸlÄ±klarÄ±nÄ± ele aldÄ±ktan sonra basit bir malware tarayÄ±cÄ± geliÅŸtireceÄŸiz. Bu proje, dosya hashâ€™lerini kullanarak zararlÄ± yazÄ±lÄ±m tespiti yapabilen bir tool olacak. Ben de bu projeyi yaparken araÅŸtÄ±rma ve ilerleme adÄ±mlarÄ±mÄ± bu yazÄ±da anlatÄ±yor olacaÄŸÄ±m. Ä°lk Ã¶nce araÅŸtÄ±rma konularÄ±nÄ± anlatarak ilerleyeceÄŸiz sonrasÄ±nda da projenin geliÅŸtirilme aÅŸamasÄ±nÄ± gÃ¶receÄŸiz.

### Malware nedir?

Malware, â€œMalicious Softwareâ€ kelimelerindeki ilk kelimenin ilk 3 harfi ve 2. kelimenin son 4 harfinin birleÅŸiminden oluÅŸan, TÃ¼rkÃ§eâ€™ye de â€œkÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mâ€ olarak Ã§evrilen bir kelimedir. Temel amacÄ± ise verileri Ã§almak, sistemi bozmak ya da gizlice kontrol altÄ±na almak amacÄ±yla hareket etmektir. Buradan da sadece bilgisayar sistemlerine zarar vermek dÄ±ÅŸÄ±nda, mobilde ve IoT cihazlarÄ±nda da yer alabileceÄŸini Ã§Ä±kartabiliriz.

### Malware TÃ¼rleri

![](https://cdn-images-1.medium.com/max/800/1*XKY5-Rxo8LAyjxEVl_ykCA.png)

*   **_VirÃ¼s:_** Bir programÄ±n ya da dosyanÄ±n iÃ§ine gizlenip sistemde yayÄ±lmaya Ã§alÄ±ÅŸÄ±r. KullanÄ±cÄ± bir dosyayÄ± Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ± anda aktif olurlar genelde.
*   **_Worm (Solucan):_** Bir dosyaya baÄŸlÄ± kalmadan kendini kopyalayarak aÄŸ Ã¼zerinden yayÄ±lÄ±r. HÄ±zlÄ±ca sistemler arasÄ± da yayÄ±labilir.
*   **_Trojan (Truva AtÄ±):_** Fayda saÄŸlayacakmÄ±ÅŸ gibi gÃ¶rÃ¼nen bir programdÄ±r fakat arka planda kÃ¶tÃ¼ amaÃ§lÄ± iÅŸler yapar. KullanÄ±cÄ±lar farkÄ±nda olmadan bu tÃ¼r yazÄ±lÄ±mlarÄ± indirir ve Ã§alÄ±ÅŸtÄ±rÄ±r.
*   **_Ransomware (Fidye YazÄ±lÄ±m):_** KullanÄ±cÄ±nÄ±n verilerini ÅŸifreler ve kurtarmak iÃ§in de fidye talep eder.
*   **_Spyware (Casus YazÄ±lÄ±m):_** KullanÄ±cÄ±yÄ±, fark ettirmeden izleyen ve kiÅŸisel bilgileri toplayan yazÄ±lÄ±mdÄ±r.
*   **_Adware (Reklam YazÄ±lÄ±m):_** Sisteme istemsiz olarak reklam gÃ¶steren ya da pop-upâ€™lar Ã§Ä±karan yazÄ±lÄ±mlardÄ±r. Gelir elde etmek amacÄ±yla kullanÄ±lÄ±r.
*   **_Rootkit:_** Sisteme gizlice eriÅŸim saÄŸlayarak saldÄ±rganlarÄ±n kontrolÃ¼ ele geÃ§irmesini saÄŸlar. Tespit edilmesi zordur ve sistemin derinliklerinde saklanÄ±r.
*   **_Botnet:_** Birden fazla bilgisayarÄ±n (bu bilgisayarlara zombi bilgisayarlar diyoruz) saldÄ±rganÄ±n kontrolÃ¼ altÄ±na girmesiyle oluÅŸan bir aÄŸdÄ±r. Bu aÄŸlar DDoS saldÄ±rÄ±larÄ± amacÄ±yla kullanÄ±lÄ±r.

* * *

### Malware nasÄ±l analiz edilmelidir?

2 temel yÃ¶ntem vardÄ±r. Bunlar statik analiz ve dinamik analizdir. Her ikisi de malwareâ€™in nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± anlamak ve zararlÄ± yazÄ±lÄ±mÄ± etkisiz hale getirmek iÃ§in kullanÄ±lÄ±r.

**Statik Analiz**  
Bu yÃ¶ntem, malwareâ€™in kodunu Ã§alÄ±ÅŸtÄ±rmadan incelemeye dayanÄ±r. Ã–zellikle zararlÄ± yazÄ±lÄ±mÄ±n dosya yapÄ±sÄ±nÄ±, iÃ§indeki metinleri ya da imzalarÄ± inceleyerek ne yaptÄ±ÄŸÄ±na dair fikir sahibi olabiliriz.

*   Statik analiz iÃ§in kullanÄ±lan araÃ§ ve yÃ¶ntemlere bakalÄ±m:  
    **_\* Disassembler ve Decompiler_** araÃ§larÄ± iÃ§in, malwareâ€™in iÃ§indeki makine dilini anlamak iÃ§in kullanÄ±lÄ±rlar diyebiliriz. IDA Pro, Ghidra gibi araÃ§larÄ± Ã¶rnek verebiliriz.  
    **_\* Strings analizi_** ise, dosya iÃ§inde saklÄ± olan dÃ¼z metinleri tespit etmektir. Mesela `strings` komutuyla dosyanÄ±n iÃ§inde gÃ¶mÃ¼lÃ¼ olan ÅŸifreler ya da URLâ€™ler tespit edilebilir.

Bunlar dÄ±ÅŸÄ±nda diÄŸer malware tespit araÃ§larÄ±na SonarQube, Checkmarx, Fortify gibi araÃ§larÄ± Ã¶rnek verebiliriz.

**Dinamik Analiz**  
Malwareâ€™i Ã§alÄ±ÅŸtÄ±rÄ±p davranÄ±ÅŸlarÄ±nÄ± gÃ¶zlemleyerek yapÄ±lan analizdir. Bu yÃ¶ntemle malwareâ€™in sistemde ne tÃ¼r dosyalar oluÅŸturduÄŸunu, hangi IP adreslerine baÄŸlandÄ±ÄŸÄ±nÄ± ve hangi iÅŸlemleri baÅŸlattÄ±ÄŸÄ±nÄ± gÃ¶rebiliriz.

*   Dinamik analiz iÃ§in kullanÄ±lan araÃ§ ve yÃ¶ntemlere bakalÄ±m:  
    **_\* Sandboxlar_**, korumalÄ± bir ortamda malwareâ€™i Ã§alÄ±ÅŸtÄ±rÄ±p zararlÄ± etkilerini gÃ¶zlemlemek iÃ§in kullanÄ±lÄ±r. Buna Cuckoo Sandbox aracÄ±nÄ± Ã¶rnek verebiliriz.  
    **_\* Debuggerlar_**, malwareâ€™in kodunu adÄ±m adÄ±m Ã§alÄ±ÅŸtÄ±rÄ±p neler olduÄŸunu gÃ¶zlemlemek iÃ§in kullanÄ±lÄ±r. OllyDbg ya da x64dbg araÃ§larÄ±nÄ± Ã¶rnek verebiliriz.

Bunlar dÄ±ÅŸÄ±nda Burp Suite, Wireshark, Metasploit gibi araÃ§larÄ±n yaygÄ±n olarak kullanÄ±ldÄ±ÄŸÄ±nÄ± da sÃ¶ylemekte fayda var.

### Malware imzasÄ±Â nedir?

Malware imzasÄ±, belirli ve benzersiz bir Ã¶zelliÄŸini yani malwareâ€™in malware olduÄŸunu anlamamÄ±zÄ± saÄŸlayan bir Ã¶zelliÄŸini ifade eder. Her malware tÃ¼rÃ¼nÃ¼n kendine Ã¶zgÃ¼ bir parmak izi olduÄŸunu dÃ¼ÅŸÃ¼nebiliriz. YazÄ±lÄ±mÄ±n kod yapÄ±sÄ±na ya da davranÄ±ÅŸlarÄ±na dayanarak oluÅŸturulan bir tanÄ±mlayÄ±cÄ±dÄ±r. Ä°mza tabanlÄ± tespit sistemlerinde kullanÄ±lÄ±r ve dosyanÄ±n zararlÄ± olup olmadÄ±ÄŸÄ±nÄ± belirlemek iÃ§in dosyanÄ±n bu imzalarla karÅŸÄ±laÅŸtÄ±rÄ±lmasÄ± yapÄ±lÄ±r.

Peki malware imzasÄ± nasÄ±l oluÅŸur? ÅÃ¶yle, yukarÄ±da yazÄ±lÄ±mÄ±n kod yapÄ±sÄ±ndan bahsetmiÅŸtik. Bu kod yapÄ±larÄ± benzersiz olabilir ya da belirli karakter dizileri iÃ§erebilir. Bunlar da malware analizcileri tarafÄ±ndan â€œimzaâ€ olarak belirlenir. YukarÄ±da da sÃ¶ylediÄŸimiz gibi her zararlÄ± yazÄ±lÄ±m imzasÄ± onun parmak izi gibidir. AynÄ± tÃ¼rdeki zararlÄ± yazÄ±lÄ±mlar aynÄ± imzaya sahip olabilir.

**Ä°mza tÃ¼rleri:**

*   **_Hash imzalarÄ±:_** Bir dosyanÄ±n hash deÄŸeri, dosyanÄ±n iÃ§eriÄŸinin bir Ã¶zetini oluÅŸturur. AynÄ± dosya, her zaman aynÄ± hash deÄŸerini Ã¼retir.
*   **_Byte dizisi imzalarÄ±:_** Dosya iÃ§indeki belirli kod parÃ§alarÄ± ya da byte dizileri, malware imzasÄ± olarak belirlenir.
*   **_DavranÄ±ÅŸsal imzalar:_** Malwareâ€™in belirli bir sistemdeki davranÄ±ÅŸlarÄ± (mesela hangi dosyalarÄ± aÃ§tÄ±ÄŸÄ± ya da hangi IP adreslerine baÄŸlandÄ±ÄŸÄ±) da bir imza olabilir.

Bir Ã¶rnek verelim mesela bir walware programÄ± her Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda `"malicious_function"` isminde bir fonksiyon Ã§aÄŸÄ±rÄ±yor. Bu fonksiyonun kodu ÅŸu ÅŸekilde olsun:

```
mov eax, 1  
int 0x80
````

Bu 2 satÄ±rlÄ±k kod malwareâ€™in imzasÄ± olarak tanÄ±mlanabilir ve bu kodu iÃ§eren dosyalar zararlÄ± olarak iÅŸaretlenebilir.

* * *

### YARA KurallarÄ±

![](https://cdn-images-1.medium.com/max/800/0*j0n4R8scohTQgkRI.png)

Ã–ncelikle aÃ§Ä±lÄ±mÄ± **_Yet Another Recursive Acronym_** olan bu kurallar, malwareâ€™i tespit etmek iÃ§in kullanÄ±lÄ±r. YARAâ€™nÄ±n amacÄ±, dosyalarÄ±n iÃ§eriÄŸinde belirli desenleri takip ederek, bilinen kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlarÄ± ve benzer davranÄ±ÅŸlar sergileyen yeni tehditleri tanÄ±mlamaktÄ±r yani kÄ±saca malwareâ€™in imzasÄ±nÄ± tanÄ±mlamak iÃ§in kullanÄ±lÄ±r. YARA, dosyadaki belirli karakterleri bulmakla sÄ±nÄ±rlÄ± kalmayÄ±p kullanÄ±cÄ± tanÄ±mlÄ± kurallar oluÅŸturmamÄ±za da olanak verir.

**YARA kurallarÄ± nasÄ±l Ã§alÄ±ÅŸÄ±r?**  
Bir dosyanÄ±n belirli bir bÃ¶lÃ¼mÃ¼nde belirli bir deseni, metni ya da karakter dizisini arar. Bir YARA kuralÄ± nasÄ±l yazÄ±lÄ±r ona bakÄ±p Ã¶rnek verirsek daha iyi anlarÄ±z.

*   **_Rule:_** KuralÄ±n adÄ±.
*   **_Strings:_** Aranacak belirli karakter dizileri.
*   **_Condition:_** KuralÄ±n hangi durumlarda tetikleneceÄŸi (mesela, belirli bir dizi bulunduktan sonra).

AÅŸaÄŸÄ±da YARA kuralÄ± yapÄ±sÄ±na bakalÄ±m ÅŸimdi de.

```
rule MalwareExample  
{  
    meta:  
        description = "Malware tespit Ã¶rneÄŸi"  
        author = "Beyza"  
        date = "2024-09-07"  
      
    strings:  
        $malicious\_string1 = "malicious\_function"  
        $malicious\_string2 = { E8 ?? ?? ?? ?? 85 C0 75 2E }  
  
    condition:  
        $malicious\_string1 or $malicious\_string2  
}
```

Bu kuralÄ±n detaylarÄ±na bakacak olursak:

*   **_Meta bÃ¶lÃ¼mÃ¼:_** Kural hakkÄ±nda bilgi verir. Bu bÃ¶lÃ¼mde kuralÄ±n kim tarafÄ±ndan yazÄ±ldÄ±ÄŸÄ±, tarihi ve aÃ§Ä±klamasÄ± yer alÄ±r.
*   **_Strings bÃ¶lÃ¼mÃ¼:_** Malwareâ€™in iÃ§erdiÄŸi belirli karakter dizilerini tanÄ±mlar. Ä°lk string bir dÃ¼z metin ararken, ikincisi bir hexadecimal dizi arar. Hexadecimal, makine dilinde Ã§alÄ±ÅŸacak olan talimatlarÄ±n gÃ¶sterimi olabilir.
*   **_Condition bÃ¶lÃ¼mÃ¼:_** KuralÄ±n ne zaman tetikleneceÄŸini belirler. Mesela yukarÄ±daki Ã¶rnek Ã¼zerinden gidecek olursak, dosyada `$malicious_string1` ya da `$malicious_string2` bulunduÄŸunda kural tetiklenir.

Buraya kadar Ã¶ÄŸrendiklerimizden aslÄ±nda avantajlarÄ±nÄ± da az Ã§ok anlamÄ±ÅŸ olduk. Mesela kendi kurallarÄ±mÄ±zÄ± yazmamÄ±za imkan vermesi, aynÄ± tÃ¼rden olup farklÄ± varyantlarÄ± bulunan zararlÄ± yazÄ±lÄ±mlar iÃ§in de genel kurallar yazmamÄ±za olanak tanÄ±masÄ± bize esneklik ve genelleme saÄŸlÄ±yor diyebiliriz. AynÄ± zamanda birÃ§ok farklÄ± koÅŸulu ve diziyi aynÄ± kuralda kullanarak kompleks yapÄ±larÄ± bile analiz edebiliriz burada da bize modÃ¼ler yapÄ± sunuyor. Bu sayede bÃ¼yÃ¼k dosya havuzlarÄ± Ã¼zerinde Ã§alÄ±ÅŸtÄ±rabiliriz. SektÃ¶rde de Ã¶zellikle antivirÃ¼s ÅŸirketleri, gÃ¼venlik analistleri ve tehdit avcÄ±larÄ± tarafÄ±ndan tercih ediliyor.

* * *

### Malware Detectionâ€™da Classification Methods KullanÄ±mÄ±

![](https://cdn-images-1.medium.com/max/800/1*DEv-jLLI644oZsxCdfQLdQ.png)

SÄ±nÄ±flandÄ±rma yÃ¶ntemleri, bir dosyanÄ±n zararlÄ± mÄ± yoksa zararsÄ±z mÄ± olduÄŸunu anlamak iÃ§in kullanÄ±lÄ±r. 2 ana sÄ±nÄ±flandÄ±rma yÃ¶ntemi vardÄ±r ve daha geliÅŸmiÅŸ bir yÃ¶ntem olan makine tabanlÄ± sÄ±nÄ±flandÄ±rma da mevcuttur. Åimdi bu yÃ¶ntemlere bakalÄ±m.

1.  **Ä°mza TabanlÄ± Tespit (Signature Based Detection)**  
    Bu yÃ¶ntemde daha Ã¶nce tanÄ±mlanmÄ±ÅŸ zararlÄ± yazÄ±lÄ±m Ã¶rneklerinin imzalarÄ± (hashâ€™ler ya da belirli byte dizileri) veri tabanÄ±nda tutulur. Bir dosya tarandÄ±ÄŸÄ±nda, dosyanÄ±n hashâ€™i ya da kod parÃ§alarÄ± bu imzalarla karÅŸÄ±laÅŸtÄ±rÄ±lÄ±r. EÄŸer bir eÅŸleÅŸme bulunursa, dosya zararlÄ± olarak iÅŸaretlenir.  
    _Mesela bir zararlÄ± yazÄ±lÄ±mÄ±n SHA-256 imzasÄ± veri tabanÄ±nda bulunuyorsa ve taranan dosyanÄ±n hash deÄŸeri bu imzayla eÅŸleÅŸiyorsa, bu dosya zararlÄ± olarak tespit edilebilir._  
    **_AvantajlarÄ±_** arasÄ±nda, hÄ±zlÄ± olmasÄ± ve belirli zararlÄ± yazÄ±lÄ±mlarÄ± %100 doÄŸrulukla tespit edebildiÄŸini sayabiliriz.  
    **_DezavantajlarÄ±_** iÃ§inse, yalnÄ±zca daha Ã¶nce tanÄ±mlanmÄ±ÅŸ malwareâ€™leri tespit etmesi yani yeni tÃ¼r malwareâ€™ler ya da varyantlarÄ± bu yÃ¶ntemi aÅŸabilir diyebiliriz.
2.  **Herustik/DaavranÄ±ÅŸ TabanlÄ± Tespit (Heuristic/Behavior-Based Detection)**  
    Bu yÃ¶ntemde, dosyanÄ±n nasl davrandÄ±ÄŸÄ±na bakÄ±lÄ±r. Mesela bir program:  
    \- KayÄ±t defterini deÄŸiÅŸtirmeye Ã§alÄ±ÅŸÄ±yor mu?  
    \- Gizli bir ÅŸekilde aÄŸ Ã¼zerinden veri mi gÃ¶nderiyor?  
    \- Sistem dosyalarÄ±nÄ± mÄ± deÄŸiÅŸtiriyor?  
    EÄŸer dosya ÅŸÃ¼pheli bir davranÄ±ÅŸ sergiliiyorsa, bu dosya zararlÄ± olarak iÅŸaretlenebilir. Bu yÃ¶ntemin Ã¶zellikle yeni malware tÃ¼rlerinin tespitinde etkili olduÄŸunu sÃ¶ylemekte fayda var.  
    Mesela bir dosya taranÄ±rken, birden fazla ÅŸÃ¼pheli davranÄ±ÅŸ gÃ¶zlemleniyorsa (Ã¶rnek olarak, dosya sistemi Ã¼zerinde yetkisiz deÄŸiÅŸiklikler yapÄ±yorsa), bu dosya zararlÄ± olarak sÄ±nÄ±flandÄ±rÄ±labilir.  
    **_AvantajlarÄ±_** arasÄ±nda, yeni ve bilinmeyen tehditleri tespit edebilmesi, zamanla daha akÄ±llÄ± hale gelip makine Ã¶ÄŸrenimi kullanÄ±larak gÃ¼ncellenebilir olmasÄ±nÄ± sÄ±ralayabiliriz.  
    **_DezavantajlarÄ±_** arasÄ±nda ise, yanlÄ±ÅŸ ve pozitif sonuÃ§lar verebilir yani zararsÄ±z bir dosyayÄ± zararlÄ± olarak iÅŸaretleyebilmesini sÃ¶yleyebiliriz.
3.  **Makine Ã–ÄŸrenimi TabanlÄ± SÄ±nÄ±flandÄ±rma**  
    Makine Ã¶ÄŸrenimi, bÃ¼yÃ¼k miktarda veriden Ã¶ÄŸrenerek yeni tÃ¼r malwareâ€™leri tespit etmekte kullanÄ±lÄ±r. Model, zararlÄ± ve zararsÄ±z dosyalar Ã¼zerinde eÄŸitilerek bir dosyanÄ±n hangi sÄ±nÄ±fa ait olduÄŸunu tahmin eder.  
    _Mesela, bir makine Ã¶ÄŸrenme modeline Ã§eÅŸitli zararlÄ± yazÄ±lÄ±m dosyalarÄ± verilir ve bu model yeni bir dosya Ã¼zerinde Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda, dosyanÄ±n zararlÄ± olup olmadÄ±ÄŸÄ±nÄ± %95 doÄŸrulukla tahmin eder._

* * *

> YazÄ±nÄ±n baÅŸÄ±nda malware ile temel araÅŸtÄ±rma konularÄ±nÄ± bildikten sonra bir malware tarayÄ±cÄ±sÄ± geliÅŸtireceÄŸimizden bahsetmiÅŸtim. Bu bÃ¶lÃ¼mde de Ã¶nce bu tarayÄ±cÄ±nÄ±n ne olduÄŸundan bahsedeceÄŸim. Bu araÃ§larÄ±n arka planda nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±, dosyalarÄ±n zararlÄ± ya da zararsÄ±z olduklarÄ±nÄ± nasÄ±l tespit ettiÄŸini bilmeden kodlamaya baÅŸlamak mÃ¼mkÃ¼nÂ deÄŸil.

### Malware tarayÄ±cÄ±sÄ± nedir?

![](https://cdn-images-1.medium.com/max/800/0*OscpBpwYIL4OgJ1d.jpg)

Sistem Ã¼zerinde zararlÄ± yazÄ±lÄ±m olup olmadÄ±ÄŸÄ±nÄ± tespit etmek amacÄ±yla tarama yapan bir yazÄ±lÄ±mdÄ±r. Åu ÅŸekilde Ã§alÄ±ÅŸÄ±r:

*   Bilinen malwareâ€™lerin imzalarÄ± veri tabanÄ±nda saklanÄ±r.
*   Sistem tarandÄ±ÄŸÄ±nda dosyalarÄ±n hashâ€™leri Ã§Ä±karÄ±lÄ±r ve bu hashâ€™ler veri tabanÄ±ndaki imzalarla karÅŸÄ±laÅŸtÄ±rÄ±lÄ±r.
*   EÄŸer bir eÅŸleÅŸme bulunursa, bu dosya muhtemelen zararlÄ±dÄ±r.

**Peki hash tabanlÄ± tespitler nasÄ±l yapÄ±lÄ±r?**  
Bir dosyanÄ±n iÃ§eriÄŸinin benzersiz bir hashâ€™ini oluÅŸturup bu hashâ€™in zararlÄ± yazÄ±lÄ±mlarÄ±n bilinen hashâ€™leri ile karÅŸÄ±laÅŸtÄ±rÄ±lmasÄ±na dayanÄ±r. YukarÄ±da da anlattÄ±ÄŸÄ±mÄ±z gibi, eÄŸer bir dosyanÄ±n hash deÄŸeri, bilinen bir malwareâ€™in hash deÄŸeriyle eÅŸleÅŸirse, dosya zararlÄ± olarak iÅŸaretlenir. En yaygÄ±n kullanÄ±lan 3 hash algoritmasÄ±na bakalÄ±m:

*   **_MD5:_** HÄ±zlÄ± ama artÄ±k gÃ¼venli gÃ¶rÃ¼lmÃ¼yor Ã§Ã¼nkÃ¼ collision (Ã§akÄ±ÅŸmalar) bulundu.
*   **_SHA-1:_** MD5'ten daha gÃ¼venli fakat bu da zayÄ±f olarak gÃ¶rÃ¼lÃ¼yor.
*   **_SHA-256:_** En yaygÄ±n ve gÃ¼venli gÃ¶rÃ¼len hash algoritmasÄ±dÄ±r.

**Hash nasÄ±l hesaplanÄ±r?**  
Hash hesaplama, bir dosyanÄ±n iÃ§eriÄŸinden sabit uzunlukta bir hash Ã¼retme iÅŸlemi diyebiliriz. Python ile bir dosyanÄ±n hashâ€™ini nasÄ±l hesaplayacaÄŸÄ±mÄ±za bakalÄ±m:

```
import hashlib  
  
def hash\_file(file\_path):  
    sha256\_hash = hashlib.sha256()  
    with open(file\_path, "rb") as f:  
        \# dosyayÄ± kÃ¼Ã§Ã¼k parÃ§alar halinde okuyoruz  
        for byte\_block in iter(lambda: f.read(4096), b""):  
            sha256\_hash.update(byte\_block)  
    return sha256\_hash.hexdigest()  
  
\# Ã¶rnek kullanÄ±mÄ± ise ÅŸÃ¶yle:  
file\_hash = hash\_file("ornek\_dosya.exe")  
print(f"SHA-256 hash deÄŸeri: {file\_hash}")
````

YukarÄ±daki Ã¶rnekte bir dosyanÄ±n SHA-256 hash deÄŸerini hesaplayÄ±p Ã§Ä±ktÄ± olarak ekrana basÄ±yor.

**Malware tespiti ve analizinde nelere dikkat etmeliyiz?**  
\* Ä°mza tabanlÄ± tespit iÃ§in kullandÄ±ÄŸÄ±mÄ±z veri tabanlarÄ±nÄ±n gÃ¼ncel olmasÄ±na dikkat etmeliyiz. SÃ¼rekli yeni malwareâ€™ler ortaya Ã§Ä±ktÄ±ÄŸÄ± iÃ§in eski imzalar yetersiz kalabilir.  
\* Sadece imza tabanlÄ± tespit her zaman yeterli olmayabilir bu yÃ¼zden davranÄ±ÅŸlara dayalÄ± tespit yÃ¶ntemleri de kullanmalÄ±yÄ±z. Mesela bir dosya sÃ¼rekli olarak sistem dosyalarÄ±nÄ± deÄŸiÅŸtiriyorsa, bu ÅŸÃ¼pheli bir davranÄ±ÅŸ olabilir.  
\* Malwareâ€™i analiz ederken kendi bilgisayarÄ±mÄ±za zarar vermemek adÄ±na Sandbox gibi izole ortamlarda Ã§alÄ±ÅŸmalÄ±yÄ±z.

* * *

AraÅŸtÄ±rma konularÄ±mÄ±z bitti ve gerekli olan her ÅŸeyi Ã¶ÄŸrendiÄŸimizi dÃ¼ÅŸÃ¼nÃ¼yorum. Åimdi de proje geliÅŸtirme aÅŸamasÄ±na geÃ§elim. Projemi [**_BeyzInfectify_**](https://github.com/b-tekinli/BeyzInfectify) olarak adlandÄ±rdÄ±m ğŸ˜… ÅÃ¶yle, Detectify (Tespit) ve Infect (Enfekte etmek) kelimelerinin birleÅŸimiyle zararlÄ± yazÄ±lÄ±m analizi projesi olduÄŸunu belirtmek, Beyz ise kiÅŸisel bir dokunuÅŸ olmasÄ± aÃ§Ä±sÄ±ndan adÄ±mÄ±n uygun olduÄŸunu dÃ¼ÅŸÃ¼ndÃ¼m.

Ä°lk adÄ±m olarak malware tespiti iÃ§in yukarÄ±daki araÅŸtÄ±rmalarÄ±mÄ±z doÄŸrultusunda bir hash veritabanÄ± kullanmamÄ±z gerektiÄŸini Ã¶ÄŸrendik. Ben basit bir baÅŸlangÄ±Ã§ olmasÄ± iÃ§in [VirusShare](https://virusshare.com/) kullanacaÄŸÄ±m.

Elimizde birÂ `.txt` uzantÄ±lÄ± dosya olduÄŸu iÃ§in Ã¶ncelikle bunu Python ile nasÄ±l kullanacaÄŸÄ±mÄ±zÄ± bulmalÄ±yÄ±z. DosyanÄ±n her satÄ±rÄ±nda hash olduÄŸunu dÃ¼ÅŸÃ¼nelim:

```
abcd1234efg567..  
9876qwer543zxc..  
...
```

Bu dosyayÄ± python ile okuyabilmeliyiz. Åu ÅŸekilde okuyalÄ±m:

```
def read\_hash\_db(file\_path): \# dosya yolunu parametre olarak verdim  
    hash\_list = \[\] \# veritabanÄ±nda okuduÄŸum hashleri bu diziye ekleyeceÄŸim  
  
    with open(file\_path, 'r') as file: \# burada dosyayÄ± aÃ§tÄ±m ve okumaya baÅŸlÄ±yorum  
        for line in file: \# dosyanÄ±n her satÄ±rÄ±nÄ± line olarak alÄ±yorum  
            hash\_list.append(line.strip()) \# okuduÄŸum hash'i temizleyip listeye ekliyorum  
  
    return hash\_list \# listeyi dÃ¶ndÃ¼rÃ¼yorum
```

Burada `hash_list` adÄ±ndaki listeyi oluÅŸturduk ve iÃ§ine hashâ€™leri atÄ±yoruz ama neden atÄ±yoruz nerede kullanacaÄŸÄ±z diye sorabilirsiniz. Bu listeyi daha sonra hashâ€™leri karÅŸÄ±laÅŸtÄ±rmak iÃ§in kullanacaÄŸÄ±mÄ±z iÃ§in oluÅŸturduk.

2\. adÄ±m olarak hashâ€™leri hesaplamalÄ±yÄ±z. Bunun iÃ§in de Pythonâ€™un `hashlib` modÃ¼lÃ¼nÃ¼ kullanacaÄŸÄ±z. Yine araÅŸtÄ±rmalarÄ±mÄ±z sonucunda, en gÃ¼venli algoritma olduÄŸunu Ã¶ÄŸrendiÄŸimiz `SHA-256` kullanacaÄŸÄ±z.

```
import hashlib  
  
def calculate\_file\_hash(file\_path):  
    with open(file\_path, 'rb') as f: \# dosyayÄ± binary modda aÃ§Ä±yorum  
        sha256\_hash = hashlib.sha256() \# SHA-256 hash hesaplayÄ±cÄ±sÄ±nÄ± oluÅŸturuyorum  
          
        \# dosyayÄ± parÃ§a parÃ§a okuyup hash hesaplamasÄ±nÄ± yapÄ±yorum  
        for byte\_block in iter(lambda: f.read(4096), b""):  
            sha256\_hash.update(byte\_block)  
      
      
    return sha256\_hash.hexdigest() \# hash deÄŸerini 16'lÄ±k tabanda dÃ¶ndÃ¼rÃ¼yorum
```

YukarÄ±daki fonksiyonda kÄ±saca dosya yolunu parametre olarak aldÄ±k ve dosyanÄ±n hash deÄŸerini `hexdigest()` fonksiyonu sayesinde hexadecimal tabanda dÃ¶ndÃ¼rdÃ¼k.

3\. adÄ±m olarak dosyalarÄ± tarayÄ±p karÅŸÄ±laÅŸtÄ±rma yapmamÄ±z gerekiyor. Åimdi de dizindeki dosyalarÄ±n hashâ€™lerini bir Ã¶nceki adÄ±mda yazdÄ±ÄŸÄ±mÄ±z fonksiyon sayesinde hesaplayarak elimizdeki hash veritabanÄ±yla karÅŸÄ±laÅŸtÄ±racaÄŸÄ±z. Pythonâ€™un `os` modÃ¼lÃ¼yle belirli bir dizindeki tÃ¼m dosyalarÄ± bulabiliriz:

```
import os  
  
# taranacak dizini ve hash listesini parametre olarak veriyorum  
def scan\_directory(directory\_path, hash\_list):  
    # os.walk --> dizin iÃ§indeki tÃ¼m dosyalarÄ± tarayÄ±p her dosyanÄ±n hash'ini hesaplamaya yarar  
    for root, dirs, files in os.walk(directory\_path):  
        for file\_name in files:  
            file\_path = os.path.join(root, file\_name)  
              
            file\_hash = calculate\_file\_hash(file\_path) \# dosyanÄ±n hash'ini hesaplÄ±yoruz  
              
            # hesaplanan hash'i veritabanÄ±ndaki hash'lerle karÅŸÄ±laÅŸtÄ±rÄ±yorum  
            if file\_hash in hash\_list:  
                print(f"ZararlÄ± yazÄ±lÄ±m tespit edildi: {file\_path}")  
            else:  
                print(f"Temiz dosya: {file\_path}")
```

4\. adÄ±m olarak sonuÃ§larÄ± kaydetmemiz gerekiyor yani loglama yapacaÄŸÄ±z. SonuÃ§larÄ± bir dosyaya kaydetmek iÃ§in Pythonâ€™un `logging` modÃ¼lÃ¼nÃ¼ kullanacaÄŸÄ±z.

```
import logging  
  
# log dosyasÄ±nÄ± ayarlÄ±yoruz  
logging.basicConfig(filename='scan\_results.log', level=logging.INFO)  
  
def log\_results(file\_path, is\_malware):  
    if is\_malware:  
        logging.info(f"ZararlÄ± yazÄ±lÄ±m bulundu: {file\_path}")  
        print(f"ZararlÄ± yazÄ±lÄ±m bulundu: {file\_path}")  
    else:  
        logging.info(f"Temiz dosya: {file\_path}")  
        print(f"Temiz dosya: {file\_path}")
```

ArtÄ±k veritabanÄ±nÄ± okuyabilen, dosyalarÄ±n hashâ€™lerini hesaplayÄ±p zararlÄ± olup olmadÄ±ÄŸÄ±nÄ± kontrol edebilen, sonuÃ§larÄ± loglayan bir malware tarayÄ±cÄ±mÄ±z var.

Buna ek olarak, veritabanÄ±nÄ± gÃ¼ncel tutmak iÃ§in bir fonksiyon yazabiliriz. Parametre olarak veritabanÄ± URLâ€™i vererek yeni veritabanÄ±nÄ± indirip kaydetmesini saÄŸlayan kÃ¼Ã§Ã¼k bir fonksiyon olabilir. Bunu da ilgisi olan biri yazÄ±p bana PR atarsa memnuniyetle kabul ederim ğŸ« 

Hem projenin hem de yazÄ±nÄ±n sonuna geldik. Malware hakkÄ±nda genelgeÃ§er bilgi birikimine sahiptim ÅŸimdi Ã§ok daha fazlasÄ±na sahibim hatta elimde malware analizi yapabileceÄŸim kÃ¼Ã§Ã¼k bir tarayÄ±cÄ±m bile var ğŸ¥³ Benim iÃ§in Ã§ok verimli bir sÃ¼reÃ§ oldu. MentÃ¶rÃ¼mÃ¼z GÃ¶zde hocamÄ±za ne kadar teÅŸekkÃ¼r etsek az kalÄ±r. UmarÄ±m herkes iÃ§in verimli bir yazÄ± olmuÅŸtur. KolaylÄ±klar ğŸ’«
